"use strict";(self.webpackChunkelcengine=self.webpackChunkelcengine||[]).push([[7368],{7151:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=n(4848),o=n(8453);const a={sidebar_position:26},r="Populate",s={id:"querybuilder/populate",title:"Populate",description:"Populate is a method that allows you to retrieve related documents from other collections based on references defined in your schema. The retrieved documents are automatically embedded into the results of your query.",source:"@site/docs/querybuilder/populate.md",sourceDirName:"querybuilder",slug:"/querybuilder/populate",permalink:"/docs/querybuilder/populate",draft:!1,unlisted:!1,editUrl:"https://github.com/elcengine/elcengine.github.io/tree/main/docs/docs/querybuilder/populate.md",tags:[],version:"current",sidebarPosition:26,frontMatter:{sidebar_position:26},sidebar:"docSidebar",previous:{title:"Schedule",permalink:"/docs/querybuilder/schedule"},next:{title:"Or Fail",permalink:"/docs/querybuilder/or-fail"}},d={},l=[{value:"Usage",id:"usage",level:2},{value:"Type definitions",id:"type-definitions",level:3},{value:"Model definition",id:"model-definition",level:3},{value:"Querying with Populate",id:"querying-with-populate",level:3},{value:"You can even just populate one field if you want to:",id:"you-can-even-just-populate-one-field-if-you-want-to",level:4},{value:"Creating a new document with a referenced document",id:"creating-a-new-document-with-a-referenced-document",level:3}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"populate",children:"Populate"}),"\n",(0,i.jsx)(t.p,{children:"Populate is a method that allows you to retrieve related documents from other collections based on references defined in your schema. The retrieved documents are automatically embedded into the results of your query."}),"\n",(0,i.jsxs)(t.p,{children:["This is particularly useful for fetching associated data without having to perform multiple queries manually as well as for reducing the number of queries made to the database. This uses ",(0,i.jsx)(t.code,{children:"$lookup"})," under the hood, which is a MongoDB aggregation stage that allows you to join documents from different collections."]}),"\n",(0,i.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(t.h3,{id:"type-definitions",children:"Type definitions"}),"\n",(0,i.jsx)(t.p,{children:"Population is a bit tricky to work with in Go due to its type system. Here we utilize the power of generics to define a flexible population structure that can work with any type of documents."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'type Kingdom struct {\n\tID        primitive.ObjectID `json:"_id" bson:"_id"`\n\tName      string             `json:"name" bson:"name"`\n\tCreatedAt time.Time          `json:"created_at" bson:"created_at"`\n\tUpdatedAt time.Time          `json:"updated_at" bson:"updated_at"`\n}\n\ntype Monster struct {\n\tID         primitive.ObjectID `json:"_id" bson:"_id"`\n\tName       string             `json:"name" bson:"name"`\n\tCategory   string             `json:"category,omitempty" bson:"category,omitempty"`\n\tCreatedAt  time.Time          `json:"created_at" bson:"created_at"`\n\tUpdatedAt  time.Time          `json:"updated_at" bson:"updated_at"`\n}\n\ntype GenericBestiary[T any, Y any] struct {\n\tID      primitive.ObjectID `json:"_id" bson:"_id"`\n\tMonster T                  `json:"monster" bson:"monster"`\n\tKingdom Y                  `json:"kingdom" bson:"kingdom"`\n}\n\ntype Bestiary = GenericBestiary[any, any]\n\ntype DetailedBestiary = GenericBestiary[Monster, Kingdom]\n\ntype PartiallyDetailedBestiary = GenericBestiary[Monster, primitive.ObjectID]\n\n'})}),"\n",(0,i.jsx)(t.h3,{id:"model-definition",children:"Model definition"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'BestiaryModel := elemental.NewModel[Bestiary]("Bestiary", elemental.NewSchema(map[string]elemental.Field{\n\t"Monster": {\n\t\tType: elemental.ObjectID,\n\t\tRef:  "Monster",\n\t},\n\t"Kingdom": {\n\t\tType: elemental.ObjectID,\n\t\tRef:  "Kingdom",\n\t},\n}))\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In the example above, we define a ",(0,i.jsx)(t.code,{children:"Bestiary"})," model with two fields, ",(0,i.jsx)(t.code,{children:"Monster"})," and ",(0,i.jsx)(t.code,{children:"Kingdom"}),", which are references to other Elemental models. You can also directly provide a ",(0,i.jsx)(t.code,{children:"Collection"})," attribute into a field instead of using the ",(0,i.jsx)(t.code,{children:"Ref"})," attribute, which is a bit faster to work with and also allows to use a different collection name than the one registered in the referenced model."]}),"\n",(0,i.jsx)(t.h3,{id:"querying-with-populate",children:"Querying with Populate"}),"\n",(0,i.jsxs)(t.p,{children:["To use the ",(0,i.jsx)(t.code,{children:"Populate"})," method, you can chain it to your query. The ",(0,i.jsx)(t.code,{children:"Populate"})," method accepts a list of fields to populate and you can use it in a variety of ways depending on your preference."]}),"\n",(0,i.jsx)(t.p,{children:"There is no limitation on the number of fields you can populate, and it can be chained alongside other Elemental query methods."}),"\n",(0,i.jsxs)(t.p,{children:["Note that with ",(0,i.jsx)(t.code,{children:"Populate"})," we use the ",(0,i.jsx)(t.code,{children:"ExecInto"})," method to retrieve the results into a custom type since the base type of the model is not sufficient to hold the populated data and may even fail to unmarshal the results correctly."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'var bestiaries []DetailedBestiary\n\nBestiaryModel.Find().Populate("Monster", "Kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate("monster", "kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate("Monster").Populate("Kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate("monster").Populate("kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate("monster kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate([]string{"Monster", "Kingdom"}).ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate(primitive.M{\n    "path": "monster",\n    "pipeline": []primitive.M{\n        {"$addFields": primitive.M{\n            "category": primitive.M{"$toLower": "$category"},\n        }},\n    },\n}, "Kingdom").ExecInto(&bestiaries)\n\n// or\n\nBestiaryModel.Find().Populate(primitive.M{\n    "path": "monster",\n    "select": primitive.M{\n        "name": 1,\n        "category": 1,\n    },\n}).Populate("Kingdom").ExecInto(&bestiaries)\n'})}),"\n",(0,i.jsx)(t.h4,{id:"you-can-even-just-populate-one-field-if-you-want-to",children:"You can even just populate one field if you want to:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'var bestiaries []PartiallyDetailedBestiary\n\nBestiaryModel.Find().Populate("Monster").ExecInto(&bestiaries)\n'})}),"\n",(0,i.jsx)(t.h3,{id:"creating-a-new-document-with-a-referenced-document",children:"Creating a new document with a referenced document"}),"\n",(0,i.jsx)(t.p,{children:"When creating a new document with a reference to another document, you can directly pass the document as the value of the field. Elemental will automatically handle the reference and store the ObjectID of the referenced document."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'monster := MonsterModel.Create(Monster{\n    Name: "Griffin",\n    Category: "Beast",\n}).Exec()\n\nkingdom := KingdomModel.Create(Kingdom{\n    Name: "Temeria",\n}).Exec()\n\nbestiary := BestiaryModel.Create(Bestiary{\n    Monster: monster,\n    Kingdom: kingdom,\n}).ExecT()\n\nfmt.Println("Bestiary created with ID:", bestiary.ID.Hex())\n'})})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r});var i=n(6540);const o={},a=i.createContext(o);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}}}]);